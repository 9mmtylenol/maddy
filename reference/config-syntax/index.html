<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="../../css/style2.css">
  <link rel="stylesheet" href="../../css/mkdocs.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="ICBM" content="-37.1114, -56.8678">
<title>Configuration files syntax - maddy</title>
</head>
<body>

<header>
<nav>
<h1><a href="../..">maddy</a></h1>
</nav>
</header>

<main>

<div class="content">

<h1 id="configuration-files-syntax">Configuration files syntax</h1>
<p><strong>Note:</strong> This file is a technical document describing how
maddy parses configuration files.</p>
<p>Configuration consists of newline-delimited "directives". Each directive can
have zero or more arguments.</p>
<pre class="codehilite"><code>directive0
directive1 arg0 arg1
</code></pre>

<p>Any line starting with # is ignored. Empty lines are ignored too.</p>
<h2 id="quoting">Quoting</h2>
<p>Strings with whitespace should be wrapped into double quotes to make sure they
will be interpreted as a single argument.</p>
<pre class="codehilite"><code>directive0 two arguments
directive1 &quot;one argument&quot;
</code></pre>

<p>String wrapped in quotes may contain newlines and they will not be interpreted
as a directive separator.</p>
<pre class="codehilite"><code>directive0 &quot;one long big
argument for directive0&quot;
</code></pre>

<p>Quotes and only quotes can be escaped inside literals: \"</p>
<p>Backslash can be used at the end of line to continue the directve on the next
line.</p>
<h2 id="blocks">Blocks</h2>
<p>A directive may have several subdirectives. They are written in a {-enclosed
block like this:</p>
<pre class="codehilite"><code>directive0 arg0 arg1 {
    subdirective0 arg0 arg1
    subdirective1 etc
}
</code></pre>

<p>Subdirectives can have blocks too.</p>
<pre class="codehilite"><code>directive0 {
    subdirective0 {
        subdirective2 {
            a
            b
            c
        }
    }
    subdirective1 { }
}
</code></pre>

<p>Level of nesting is limited, but you should never hit the limit with correct
configuration.</p>
<p>In most cases, an empty block is equivalent to no block:</p>
<pre class="codehilite"><code>directive { }
directive2 # same as above
</code></pre>

<h2 id="environment-variables">Environment variables</h2>
<p>Environment variables can be referenced in the configuration using either
{env:VARIABLENAME} syntax.</p>
<p>Non-existent variables are expanded to empty strings and not removed from
the arguments list.  In the following example, directive0 will have one argument
independently of whether VAR is defined.</p>
<pre class="codehilite"><code>directive0 {env:VAR}
</code></pre>

<p>Parse is forgiving and incomplete variable placeholder (e.g. '{env:VAR') will
be left as-is. Variables are expanded inside quotes too.</p>
<h2 id="snippets-imports">Snippets &amp; imports</h2>
<p>You can reuse blocks of configuration by defining them as "snippets". Snippet
is just a directive with a block, declared tp top level (not inside any blocks)
and with a directive name wrapped in curly braces.</p>
<pre class="codehilite"><code>(snippetname) {
    a
    b
    c
}
</code></pre>

<p>The snippet can then be referenced using 'import' meta-directive.</p>
<pre class="codehilite"><code>unrelated0
unrelated1
import snippetname
</code></pre>

<p>The above example will be expanded into the following configuration:</p>
<pre class="codehilite"><code>unrelated0
unrelated1
a
b
c
</code></pre>

<p>Import statement also can be used to include content from other files. It works
exactly the same way as with snippets but the file path should be used instead.
The path can be either relative to the location of the currently processed
configuration file or absolute. If there are both snippet and file with the
same name - snippet will be used.</p>
<pre class="codehilite"><code># /etc/maddy/tls.conf
tls long_path_to_certificate long_path_to_private_key

# /etc/maddy/maddy.conf
smtp tcp://0.0.0.0:25 {
    import tls.conf
}
</code></pre>

<pre class="codehilite"><code># Expanded into:
smtp tcp://0.0.0.0:25 {
    tls long_path_to_certificate long_path_to_private_key
}
</code></pre>

<p>The imported file can introduce new snippets and they can be referenced in any
processed configuration file.</p>
<h2 id="duration-values">Duration values</h2>
<p>Directives that accept duration use the following format: A sequence of decimal
digits with an optional fraction and unit suffix (zero can be specified without
a suffix). If multiple values are specified, they will be added.</p>
<p>Valid unit suffixes: "h" (hours), "m" (minutes), "s" (seconds), "ms" (milliseconds).
Implementation also accepts us and ns for microseconds and nanoseconds, but these
values are useless in practice.</p>
<p>Examples:</p>
<pre class="codehilite"><code>1h
1h 5m
1h5m
0
</code></pre>

<h2 id="data-size-values">Data size values</h2>
<p>Similar to duration values, but fractions are not allowed and suffixes are different.</p>
<p>Valid unit suffixes: "G" (gibibyte, 1024^3 bytes), "M" (mebibyte, 1024^2 bytes),
"K" (kibibyte, 1024 bytes), "B" or "b" (byte).</p>
<p>Examples:</p>
<pre class="codehilite"><code>32M
3M 5K
5b
</code></pre>

<p>Also note that the following is not valid, unlike Duration values syntax:</p>
<pre class="codehilite"><code>32M5K
</code></pre>

<h1 id="address-definitions">ADDRESS DEFINITIONS</h1>
<p>Maddy configuration uses URL-like syntax to specify network addresses.</p>
<ul>
<li>
<p>unix://file_path
  Unix domain socket. Relative paths are relative to runtime directory
  (/run/maddy).</p>
</li>
<li>
<p>tcp://ADDRESS:PORT
  TCP/IP socket.</p>
</li>
<li>
<p>tls://ADDRESS:PORT
  TCP/IP socket using TLS.</p>
</li>
</ul>
<h1 id="dummy-module">DUMMY MODULE</h1>
<p>No-op module. It doesn't need to be configured explicitly and can be referenced
using "dummy" name. It can act as a delivery target or auth.
provider. In the latter case, it will accept any credentials, allowing any
client to authenticate using any username and password (use with care!).</p>
</div>

<div class="side">




<div class="search">
  <form class="search" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs"
        title="Type search term here" />
  </form>
</div>


<div class="toc" aria-label="main navigation">
<ul>

    <li>
		<a href="../../faq/"
				class="">
			Frequently Asked Questions</a>

        
    </li>

    <li>
		<span>Tutorials</span>

        
            <ul>
            
                <li>
		<a href="../../tutorials/setting-up/"
				class="">
			Installation & initial configuration</a>

        
    </li>
            
                <li>
		<a href="../../tutorials/building-from-source/"
				class="">
			Building from source</a>

        
    </li>
            
                <li>
		<a href="../../tutorials/alias-to-remote/"
				class="">
			Forward messages to a remote MX</a>

        
    </li>
            
                <li>
		<a href="../../tutorials/pam/"
				class="">
			Using PAM authentication</a>

        
    </li>
            
            </ul>
        
    </li>

    <li>
		<a href="https://maddy.email/builds/"
				class="">
			Release builds</a>

        
    </li>

    <li>
		<a href="../../multiple-domains/"
				class="">
			Multiple domains configuration</a>

        
    </li>

    <li>
		<a href="../../upgrading/"
				class="">
			Upgrading from older maddy versions</a>

        
    </li>

    <li>
		<a href="../../seclevels/"
				class="">
			Outbound delivery security</a>

        
    </li>

    <li>
		<a href="../../docker/"
				class="">
			Docker</a>

        
    </li>

    <li>
		<span>Reference manual</span>

        
            <ul>
            
                <li>
		<a href="../modules/"
				class="">
			Modules introduction</a>

        
    </li>
            
                <li>
		<a href="../global-config/"
				class="">
			Global configuration directives</a>

        
    </li>
            
                <li>
		<a href="../tls/"
				class="">
			TLS configuration</a>

        
    </li>
            
                <li>
		<a href="../tls-acme/"
				class="">
			Automatic certificate management via ACME</a>

        
    </li>
            
                <li>
		<span>Endpoints configuration</span>

        
            <ul>
            
                <li>
		<a href="../endpoints/imap/"
				class="">
			IMAP4rev1 endpoint</a>

        
    </li>
            
                <li>
		<a href="../endpoints/smtp/"
				class="">
			SMTP/LMTP/Submission endpoint</a>

        
    </li>
            
                <li>
		<a href="../endpoints/openmetrics/"
				class="">
			OpenMetrics/Prometheus telemetry</a>

        
    </li>
            
            </ul>
        
    </li>
            
                <li>
		<span>IMAP storage</span>

        
            <ul>
            
                <li>
		<a href="../storage/imap-filters/"
				class="">
			IMAP filters</a>

        
    </li>
            
                <li>
		<a href="../storage/imapsql/"
				class="">
			SQL-indexed storage</a>

        
    </li>
            
                <li>
		<span>Blob storage</span>

        
            <ul>
            
                <li>
		<a href="../blob/fs/"
				class="">
			Filesystem</a>

        
    </li>
            
                <li>
		<a href="../blob/s3/"
				class="">
			Amazon S3</a>

        
    </li>
            
            </ul>
        
    </li>
            
            </ul>
        
    </li>
            
                <li>
		<a href="../smtp-pipeline/"
				class="">
			SMTP message routing (pipeline)</a>

        
    </li>
            
                <li>
		<span>SMTP targets</span>

        
            <ul>
            
                <li>
		<a href="../targets/queue/"
				class="">
			Local queue</a>

        
    </li>
            
                <li>
		<a href="../targets/remote/"
				class="">
			Remote MX delivery</a>

        
    </li>
            
                <li>
		<a href="../targets/smtp/"
				class="">
			SMTP & LMTP transparent forwarding</a>

        
    </li>
            
            </ul>
        
    </li>
            
                <li>
		<span>SMTP checks</span>

        
            <ul>
            
                <li>
		<a href="../checks/actions/"
				class="">
			Check actions</a>

        
    </li>
            
                <li>
		<a href="../checks/dkim/"
				class="">
			DKIM</a>

        
    </li>
            
                <li>
		<a href="../checks/spf/"
				class="">
			SPF</a>

        
    </li>
            
                <li>
		<a href="../checks/milter/"
				class="">
			Milter client</a>

        
    </li>
            
                <li>
		<a href="../checks/rspamd/"
				class="">
			rspamd</a>

        
    </li>
            
                <li>
		<a href="../checks/dnsbl/"
				class="">
			DNSBL lookup</a>

        
    </li>
            
                <li>
		<a href="../checks/command/"
				class="">
			System command filter</a>

        
    </li>
            
                <li>
		<a href="../checks/authorize_sender/"
				class="">
			MAIL FROM and From authorization</a>

        
    </li>
            
                <li>
		<a href="../checks/misc/"
				class="">
			Misc checks</a>

        
    </li>
            
            </ul>
        
    </li>
            
                <li>
		<span>SMTP modifiers</span>

        
            <ul>
            
                <li>
		<a href="../modifiers/dkim/"
				class="">
			DKIM signing</a>

        
    </li>
            
                <li>
		<a href="../modifiers/envelope/"
				class="">
			Envelope sender / recipient rewriting</a>

        
    </li>
            
            </ul>
        
    </li>
            
                <li>
		<span>Lookup tables (string translation)</span>

        
            <ul>
            
                <li>
		<a href="../table/static/"
				class="">
			Static table</a>

        
    </li>
            
                <li>
		<a href="../table/regexp/"
				class="">
			Regexp rewrite table</a>

        
    </li>
            
                <li>
		<a href="../table/file/"
				class="">
			File</a>

        
    </li>
            
                <li>
		<a href="../table/sql_query/"
				class="">
			SQL query mapping</a>

        
    </li>
            
                <li>
		<a href="../table/chain/"
				class="">
			Table chaining</a>

        
    </li>
            
                <li>
		<a href="../table/email_localpart/"
				class="">
			Email local part</a>

        
    </li>
            
                <li>
		<a href="../table/auth/"
				class="">
			Authentication providers</a>

        
    </li>
            
            </ul>
        
    </li>
            
                <li>
		<span>Authentication providers</span>

        
            <ul>
            
                <li>
		<a href="../auth/pass_table/"
				class="">
			Password table</a>

        
    </li>
            
                <li>
		<a href="../auth/pam/"
				class="">
			PAM</a>

        
    </li>
            
                <li>
		<a href="../auth/shadow/"
				class="">
			/etc/shadow</a>

        
    </li>
            
                <li>
		<a href="../auth/external/"
				class="">
			System command</a>

        
    </li>
            
                <li>
		<a href="../auth/ldap/"
				class="">
			LDAP BindDN</a>

        
    </li>
            
                <li>
		<a href="../auth/dovecot_sasl/"
				class="">
			Dovecot SASL</a>

        
    </li>
            
                <li>
		<a href="../auth/plain_separate/"
				class="">
			Separate username and password lookup</a>

        
    </li>
            
            </ul>
        
    </li>
            
                <li>
		<a href="./"
				class="current">
			Configuration files syntax</a>
		
			
                <ul>
                
                    <li class="local">
                        <a href="#quoting">Quoting</a>
                    </li>
                
                    <li class="local">
                        <a href="#blocks">Blocks</a>
                    </li>
                
                    <li class="local">
                        <a href="#environment-variables">Environment variables</a>
                    </li>
                
                    <li class="local">
                        <a href="#snippets-imports">Snippets &amp; imports</a>
                    </li>
                
                    <li class="local">
                        <a href="#duration-values">Duration values</a>
                    </li>
                
                    <li class="local">
                        <a href="#data-size-values">Data size values</a>
                    </li>
                
                </ul>
            
        
			
        
			
        
        

        
    </li>
            
            </ul>
        
    </li>

    <li>
		<span>Integration with software</span>

        
            <ul>
            
                <li>
		<a href="../../third-party/dovecot/"
				class="">
			Dovecot</a>

        
    </li>
            
                <li>
		<a href="../../third-party/smtp-servers/"
				class="">
			External SMTP server</a>

        
    </li>
            
                <li>
		<a href="../../third-party/rspamd/"
				class="">
			rspamd</a>

        
    </li>
            
                <li>
		<a href="../../third-party/mailman3/"
				class="">
			Mailman 3</a>

        
    </li>
            
            </ul>
        
    </li>

    <li>
		<span>Internals</span>

        
            <ul>
            
                <li>
		<a href="../../internals/specifications/"
				class="">
			Followed specifications</a>

        
    </li>
            
                <li>
		<a href="../../internals/unicode/"
				class="">
			Unicode support</a>

        
    </li>
            
                <li>
		<a href="../../internals/quirks/"
				class="">
			Implementation quirks</a>

        
    </li>
            
                <li>
		<a href="../../internals/sqlite/"
				class="">
			maddy & SQLite</a>

        
    </li>
            
            </ul>
        
    </li>

</ul>
</div>
</div>

</main>

<footer>
<div>
Thanks <a href="https://blitiri.com.ar/">Alberto Bertogli</a> for providing base for this neat mkdocs theme!
Last updated: 2022-12-05
</div>
</footer>

<!-- For search -->
<script>var base_url = '../..';</script>
<script src="../../search/main.js" defer></script>


</body>
</html>


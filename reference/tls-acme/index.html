<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="../../css/style2.css">
  <link rel="stylesheet" href="../../css/mkdocs.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="ICBM" content="-37.1114, -56.8678">
<title>Automatic certificate management via ACME - maddy</title>
</head>
<body>

<header>
<nav>
<h1><a href="../..">maddy</a></h1>
</nav>
</header>

<main>

<div class="content">

<h1 id="automatic-certificate-management-via-acme">Automatic certificate management via ACME</h1>
<p>Maddy supports obtaining certificates using ACME protocol.</p>
<p>To use it, create a configuration name for tls.loader.acme
and reference it from endpoints that should use automatically
configured certificates:</p>
<pre class="codehilite"><code>tls.loader.acme local_tls {
    email put-your-email-here@example.org
    agreed # indicate your agreement with Let's Encrypt ToS
    challenge dns-01
}

smtp tcp://127.0.0.1:25 {
    tls &amp;local_tls
    ...
}
</code></pre>

<p>You can also use a global <code>tls</code> directive to use automatically
obtained certificates for all endpoints:</p>
<pre class="codehilite"><code>tls &amp;local_tls
</code></pre>

<p>Currently the only supported challenge is dns-01 one therefore
you also need to configure the DNS provider:</p>
<pre class="codehilite"><code>tls.loader.acme local_tls {
    email maddy-acme@example.org
    agreed
    challenge dns-01
    dns PROVIDER_NAME {
        ...
    }
}
</code></pre>

<p>See below for supported providers and necessary configuration
for each.</p>
<h2 id="configuration-directives">Configuration directives</h2>
<pre class="codehilite"><code>tls.loader.acme {
    debug off
    hostname example.maddy.invalid
    store_path /var/lib/maddy/acme
    ca https://acme-v02.api.letsencrypt.org/directory
    test_ca https://acme-staging-v02.api.letsencrypt.org/directory
    email test@maddy.invalid
    agreed off
    challenge dns-01
    dns ...
}
</code></pre>

<p><strong>Syntax:</strong> debug <em>boolean</em> <br>
<strong>Default:</strong> global directive value</p>
<p>Enable debug logging.</p>
<p><strong>Syntax:</strong> hostname <em>str</em> <br>
<strong>Default:</strong> global directive value</p>
<p>Domain name to issue certificate for. Required.</p>
<p><strong>Syntax:</strong> store_path <em>path</em> <br>
<strong>Default:</strong> state_dir/acme</p>
<p>Where to store issued certificates and associated metadata.
Currently only filesystem-based store is supported.</p>
<p><strong>Syntax:</strong> ca <em>url</em> <br>
<strong>Default:</strong> Let's Encrypt production CA</p>
<p>URL of ACME directory to use.</p>
<p><strong>Syntax:</strong> test_ca <em>url</em> <br>
<strong>Default:</strong> Let's Encrypt staging CA</p>
<p>URL of ACME directory to use for retries should
primary CA fail.</p>
<p>maddy will keep attempting to issues certificates
using test_ca until it succeeds then it will switch
back to the one configured via 'ca' option.</p>
<p>This avoids rate limit issues with production CA.</p>
<p><strong>Syntax:</strong> email <em>str</em> <br>
<strong>Default:</strong> not set</p>
<p>Email to pass while registering an ACME account.</p>
<p><strong>Syntax:</strong> agreed <em>boolean</em> <br>
<strong>Default:</strong> false</p>
<p>Whether you agreed to ToS of the CA service you are using.</p>
<p><strong>Syntax:</strong> challenge dns-01 <br>
<strong>Default:</strong> not set</p>
<p>Challenge(s) to use while performing domain verification.</p>
<h2 id="dns-providers">DNS providers</h2>
<p>Support for some providers is not provided by standard builds.
To be able to use these, you need to compile maddy
with "libdns_PROVIDER" build tag.
E.g.</p>
<pre class="codehilite"><code>./build.sh -tags 'libdns_googleclouddns'
</code></pre>

<ul>
<li>gandi</li>
</ul>
<pre class="codehilite"><code>dns gandi {
    api_token &quot;token&quot;
}
</code></pre>

<ul>
<li>digitalocean</li>
</ul>
<pre class="codehilite"><code>dns digitalocean {
    api_token &quot;...&quot;
}
</code></pre>

<ul>
<li>cloudflare</li>
</ul>
<p>See <a href="https://github.com/libdns/cloudflare#authenticating">https://github.com/libdns/cloudflare#authenticating</a></p>
<pre class="codehilite"><code>dns cloudflare {
    api_token &quot;...&quot;
}
</code></pre>

<ul>
<li>vultr</li>
</ul>
<pre class="codehilite"><code>dns vultr {
    api_token &quot;...&quot;
}
</code></pre>

<ul>
<li>hetzner</li>
</ul>
<pre class="codehilite"><code>dns hetzner {
    api_token &quot;...&quot;
}
</code></pre>

<ul>
<li>namecheap</li>
</ul>
<pre class="codehilite"><code>dns namecheap {
    api_key &quot;...&quot;
    api_username &quot;...&quot;

    # optional: API endpoint, production one is used if not set.
    endpoint &quot;https://api.namecheap.com/xml.response&quot;

    # optional: your public IP, discovered using icanhazip.com if not set
    client_ip 1.2.3.4
}
</code></pre>

<ul>
<li>googleclouddns (non-default)</li>
</ul>
<pre class="codehilite"><code>dns googleclouddns {
    project &quot;project_id&quot;
    service_account_json &quot;path&quot;
}
</code></pre>

<ul>
<li>route53 (non-default)</li>
</ul>
<pre class="codehilite"><code>dns route53 {
    secret_access_key &quot;...&quot;
    access_key_id &quot;...&quot;
    # or use environment variables: AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY
}
</code></pre>

<ul>
<li>leaseweb (non-default)</li>
</ul>
<pre class="codehilite"><code>dns leaseweb {
    api_key &quot;key&quot;
}
</code></pre>

<ul>
<li>metaname (non-default)</li>
</ul>
<pre class="codehilite"><code>dns metaname {
    api_key &quot;key&quot;
    account_ref &quot;reference&quot;
}
</code></pre>

<ul>
<li>alidns (non-default)</li>
</ul>
<pre class="codehilite"><code>dns alidns {
    key_id &quot;...&quot;
    key_secret &quot;...&quot;
}
</code></pre>

<ul>
<li>namedotcom (non-default)</li>
</ul>
<pre class="codehilite"><code>dns namedotcom {
    user &quot;...&quot;
    token &quot;...&quot;
}
</code></pre>
</div>

<div class="side">




<div class="search">
  <form class="search" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs"
        title="Type search term here" />
  </form>
</div>


<div class="toc" aria-label="main navigation">
<ul>

    <li>
		<a href="../../faq/"
				class="">
			Frequently Asked Questions</a>

        
    </li>

    <li>
		<span>Tutorials</span>

        
            <ul>
            
                <li>
		<a href="../../tutorials/setting-up/"
				class="">
			Installation & initial configuration</a>

        
    </li>
            
                <li>
		<a href="../../tutorials/building-from-source/"
				class="">
			Building from source</a>

        
    </li>
            
                <li>
		<a href="../../tutorials/alias-to-remote/"
				class="">
			Forward messages to a remote MX</a>

        
    </li>
            
                <li>
		<a href="../../tutorials/pam/"
				class="">
			Using PAM authentication</a>

        
    </li>
            
            </ul>
        
    </li>

    <li>
		<a href="https://maddy.email/builds/"
				class="">
			Release builds</a>

        
    </li>

    <li>
		<a href="../../multiple-domains/"
				class="">
			Multiple domains configuration</a>

        
    </li>

    <li>
		<a href="../../upgrading/"
				class="">
			Upgrading from older maddy versions</a>

        
    </li>

    <li>
		<a href="../../seclevels/"
				class="">
			Outbound delivery security</a>

        
    </li>

    <li>
		<a href="../../docker/"
				class="">
			Docker</a>

        
    </li>

    <li>
		<span>Reference manual</span>

        
            <ul>
            
                <li>
		<a href="../modules/"
				class="">
			Modules introduction</a>

        
    </li>
            
                <li>
		<a href="../global-config/"
				class="">
			Global configuration directives</a>

        
    </li>
            
                <li>
		<a href="../tls/"
				class="">
			TLS configuration</a>

        
    </li>
            
                <li>
		<a href="./"
				class="current">
			Automatic certificate management via ACME</a>
		
			
                <ul>
                
                    <li class="local">
                        <a href="#configuration-directives">Configuration directives</a>
                    </li>
                
                    <li class="local">
                        <a href="#dns-providers">DNS providers</a>
                    </li>
                
                </ul>
            
        
        

        
    </li>
            
                <li>
		<span>Endpoints configuration</span>

        
            <ul>
            
                <li>
		<a href="../endpoints/imap/"
				class="">
			IMAP4rev1 endpoint</a>

        
    </li>
            
                <li>
		<a href="../endpoints/smtp/"
				class="">
			SMTP/LMTP/Submission endpoint</a>

        
    </li>
            
                <li>
		<a href="../endpoints/openmetrics/"
				class="">
			OpenMetrics/Prometheus telemetry</a>

        
    </li>
            
            </ul>
        
    </li>
            
                <li>
		<span>IMAP storage</span>

        
            <ul>
            
                <li>
		<a href="../storage/imap-filters/"
				class="">
			IMAP filters</a>

        
    </li>
            
                <li>
		<a href="../storage/imapsql/"
				class="">
			SQL-indexed storage</a>

        
    </li>
            
                <li>
		<span>Blob storage</span>

        
            <ul>
            
                <li>
		<a href="../blob/fs/"
				class="">
			Filesystem</a>

        
    </li>
            
                <li>
		<a href="../blob/s3/"
				class="">
			Amazon S3</a>

        
    </li>
            
            </ul>
        
    </li>
            
            </ul>
        
    </li>
            
                <li>
		<a href="../smtp-pipeline/"
				class="">
			SMTP message routing (pipeline)</a>

        
    </li>
            
                <li>
		<span>SMTP targets</span>

        
            <ul>
            
                <li>
		<a href="../targets/queue/"
				class="">
			Local queue</a>

        
    </li>
            
                <li>
		<a href="../targets/remote/"
				class="">
			Remote MX delivery</a>

        
    </li>
            
                <li>
		<a href="../targets/smtp/"
				class="">
			SMTP & LMTP transparent forwarding</a>

        
    </li>
            
            </ul>
        
    </li>
            
                <li>
		<span>SMTP checks</span>

        
            <ul>
            
                <li>
		<a href="../checks/actions/"
				class="">
			Check actions</a>

        
    </li>
            
                <li>
		<a href="../checks/dkim/"
				class="">
			DKIM</a>

        
    </li>
            
                <li>
		<a href="../checks/spf/"
				class="">
			SPF</a>

        
    </li>
            
                <li>
		<a href="../checks/milter/"
				class="">
			Milter client</a>

        
    </li>
            
                <li>
		<a href="../checks/rspamd/"
				class="">
			rspamd</a>

        
    </li>
            
                <li>
		<a href="../checks/dnsbl/"
				class="">
			DNSBL lookup</a>

        
    </li>
            
                <li>
		<a href="../checks/command/"
				class="">
			System command filter</a>

        
    </li>
            
                <li>
		<a href="../checks/authorize_sender/"
				class="">
			MAIL FROM and From authorization</a>

        
    </li>
            
                <li>
		<a href="../checks/misc/"
				class="">
			Misc checks</a>

        
    </li>
            
            </ul>
        
    </li>
            
                <li>
		<span>SMTP modifiers</span>

        
            <ul>
            
                <li>
		<a href="../modifiers/dkim/"
				class="">
			DKIM signing</a>

        
    </li>
            
                <li>
		<a href="../modifiers/envelope/"
				class="">
			Envelope sender / recipient rewriting</a>

        
    </li>
            
            </ul>
        
    </li>
            
                <li>
		<span>Lookup tables (string translation)</span>

        
            <ul>
            
                <li>
		<a href="../table/static/"
				class="">
			Static table</a>

        
    </li>
            
                <li>
		<a href="../table/regexp/"
				class="">
			Regexp rewrite table</a>

        
    </li>
            
                <li>
		<a href="../table/file/"
				class="">
			File</a>

        
    </li>
            
                <li>
		<a href="../table/sql_query/"
				class="">
			SQL query mapping</a>

        
    </li>
            
                <li>
		<a href="../table/chain/"
				class="">
			Table chaining</a>

        
    </li>
            
                <li>
		<a href="../table/email_localpart/"
				class="">
			Email local part</a>

        
    </li>
            
                <li>
		<a href="../table/auth/"
				class="">
			Authentication providers</a>

        
    </li>
            
            </ul>
        
    </li>
            
                <li>
		<span>Authentication providers</span>

        
            <ul>
            
                <li>
		<a href="../auth/pass_table/"
				class="">
			Password table</a>

        
    </li>
            
                <li>
		<a href="../auth/pam/"
				class="">
			PAM</a>

        
    </li>
            
                <li>
		<a href="../auth/shadow/"
				class="">
			/etc/shadow</a>

        
    </li>
            
                <li>
		<a href="../auth/external/"
				class="">
			System command</a>

        
    </li>
            
                <li>
		<a href="../auth/ldap/"
				class="">
			LDAP BindDN</a>

        
    </li>
            
                <li>
		<a href="../auth/dovecot_sasl/"
				class="">
			Dovecot SASL</a>

        
    </li>
            
                <li>
		<a href="../auth/plain_separate/"
				class="">
			Separate username and password lookup</a>

        
    </li>
            
            </ul>
        
    </li>
            
                <li>
		<a href="../config-syntax/"
				class="">
			Configuration files syntax</a>

        
    </li>
            
            </ul>
        
    </li>

    <li>
		<span>Integration with software</span>

        
            <ul>
            
                <li>
		<a href="../../third-party/dovecot/"
				class="">
			Dovecot</a>

        
    </li>
            
                <li>
		<a href="../../third-party/smtp-servers/"
				class="">
			External SMTP server</a>

        
    </li>
            
                <li>
		<a href="../../third-party/rspamd/"
				class="">
			rspamd</a>

        
    </li>
            
                <li>
		<a href="../../third-party/mailman3/"
				class="">
			Mailman 3</a>

        
    </li>
            
            </ul>
        
    </li>

    <li>
		<span>Internals</span>

        
            <ul>
            
                <li>
		<a href="../../internals/specifications/"
				class="">
			Followed specifications</a>

        
    </li>
            
                <li>
		<a href="../../internals/unicode/"
				class="">
			Unicode support</a>

        
    </li>
            
                <li>
		<a href="../../internals/quirks/"
				class="">
			Implementation quirks</a>

        
    </li>
            
                <li>
		<a href="../../internals/sqlite/"
				class="">
			maddy & SQLite</a>

        
    </li>
            
            </ul>
        
    </li>

</ul>
</div>
</div>

</main>

<footer>
<div>
Thanks <a href="https://blitiri.com.ar/">Alberto Bertogli</a> for providing base for this neat mkdocs theme!
Last updated: 2022-12-05
</div>
</footer>

<!-- For search -->
<script>var base_url = '../..';</script>
<script src="../../search/main.js" defer></script>


</body>
</html>

